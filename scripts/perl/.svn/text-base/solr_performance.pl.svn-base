##################################################################
# Description: metarep_ftp_put.pl
# --------------
# Author: jgoll 
# Email:  jgoll@jcvi.org
# Date:   May 14, 2010  
##################################################################

BEGIN {
   #unshift(@INC, '/local/annotation_metagenomic/METAREP/parser/lib');
  unshift(@INC, '/export/projects/metagenomics-reports/parsers/solr/lib');
}
use MetarepDAO;
use strict;

my $solrUrl = $ARGV[0];


my $metarepDao = MetarepDAO->new();

my @libraries = $metarepDao->getPopulations();

my $cumCount=0;
my $libCount =0;

foreach(@libraries) {
	#print("curl $solrUrl/solr/$_/select?version=1.2&wt=json&json.nl=map&q=%2A%3A%2A&start=0&rows=0");
	my $curlRes = `curl "$solrUrl/solr/$_/select?version=1.2&wt=json&json.nl=map&q=%2A%3A%2A&start=0&rows=0" 2>&1`;
	my @tmp = split("numFound\":",$curlRes);
	my @tmp2 = split(",\"",$tmp[1]);
	my $count = $tmp2[0];
	if($count>0) {
		$libCount++;
	}
	else {
		print "MISSING $_ \n";
	}
	
	#print "$_\t$count\n";	
	$cumCount+=$count;
}
print "total libs\t$libCount\n";
print "total counts\t$cumCount\n";


#my @tmp2 = split(">Admin",$tmp[1]);
#
#foreach(@tmp2) {
#	print $_."\n";
#}

#print $curlRes;



